<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AJWrites</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Work+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Work Sans', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        .tab-btn.active {
            background-color: #ff6b35;
            color: white;
        }
        .modal {
            display: none;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">
                    AJ<span class="text-orange-500">Writes</span> <span class="text-lg text-gray-600 ml-2">Admin Panel</span>
                </h1>
            </div>
            <div class="flex items-center gap-4">
                <span class="text-gray-600">Welcome, <strong id="admin-username">Admin</strong></span>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex gap-2 py-4">
                <button class="tab-btn active px-6 py-2 rounded font-semibold transition" onclick="showTab('projects')">
                    Portfolio Projects
                </button>
                <button class="tab-btn px-6 py-2 rounded font-semibold transition" onclick="showTab('services')">
                    Services
                </button>
                <button class="tab-btn px-6 py-2 rounded font-semibold transition" onclick="showTab('testimonials')">
                    Testimonials
                </button>
                <button class="tab-btn px-6 py-2 rounded font-semibold transition" onclick="showTab('messages')">
                    Messages <span id="message-count" class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs ml-2">0</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- PROJECTS TAB -->
        <div id="projects-tab" class="tab-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Portfolio Projects</h2>
                <button onclick="openModal('project-modal')" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition">
                    + Add New Project
                </button>
            </div>
            
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="px-6 py-4 text-left font-semibold">Title</th>
                            <th class="px-6 py-4 text-left font-semibold">Category</th>
                            <th class="px-6 py-4 text-left font-semibold">Date</th>
                            <th class="px-6 py-4 text-right font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projects-table">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- SERVICES TAB -->
        <div id="services-tab" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Services</h2>
                <button onclick="openModal('service-modal')" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition">
                    + Add New Service
                </button>
            </div>
            
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="px-6 py-4 text-left font-semibold">Title</th>
                            <th class="px-6 py-4 text-left font-semibold">Icon</th>
                            <th class="px-6 py-4 text-left font-semibold">Description</th>
                            <th class="px-6 py-4 text-right font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="services-table">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TESTIMONIALS TAB -->
        <div id="testimonials-tab" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Testimonials</h2>
                <button onclick="openModal('testimonial-modal')" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition">
                    + Add New Testimonial
                </button>
            </div>
            
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="px-6 py-4 text-left font-semibold">Client Name</th>
                            <th class="px-6 py-4 text-left font-semibold">Title</th>
                            <th class="px-6 py-4 text-left font-semibold">Rating</th>
                            <th class="px-6 py-4 text-right font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="testimonials-table">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- MESSAGES TAB -->
        <div id="messages-tab" class="tab-content hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold">Contact Messages</h2>
            </div>
            
            <div class="space-y-4" id="messages-container">
                <!-- Dynamic content -->
            </div>
        </div>

    </div>

    <!-- PROJECT MODAL -->
    <div id="project-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Add/Edit Project</h3>
                <button onclick="closeModal('project-modal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="project-form">
                <input type="hidden" id="project-id">
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Project Title *</label>
                    <input type="text" id="project-title" required class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Category</label>
                    <input type="text" id="project-category" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Description *</label>
                    <textarea id="project-description" required rows="4" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Tags (comma-separated)</label>
                    <input type="text" id="project-tags" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-6">
                    <label class="block font-semibold mb-2">Image URL</label>
                    <input type="text" id="project-image" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="flex gap-4">
                    <button type="submit" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition flex-1">
                        Save Project
                    </button>
                    <button type="button" onclick="closeModal('project-modal')" class="bg-gray-300 text-gray-700 px-6 py-3 rounded font-semibold hover:bg-gray-400 transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SERVICE MODAL -->
    <div id="service-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Add/Edit Service</h3>
                <button onclick="closeModal('service-modal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="service-form">
                <input type="hidden" id="service-id">
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Service Title *</label>
                    <input type="text" id="service-title" required class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Icon (emoji or text)</label>
                    <input type="text" id="service-icon" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none" placeholder="✍️">
                </div>
                
                <div class="mb-6">
                    <label class="block font-semibold mb-2">Description *</label>
                    <textarea id="service-description" required rows="4" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none"></textarea>
                </div>
                
                <div class="flex gap-4">
                    <button type="submit" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition flex-1">
                        Save Service
                    </button>
                    <button type="button" onclick="closeModal('service-modal')" class="bg-gray-300 text-gray-700 px-6 py-3 rounded font-semibold hover:bg-gray-400 transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- TESTIMONIAL MODAL -->
    <div id="testimonial-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Add/Edit Testimonial</h3>
                <button onclick="closeModal('testimonial-modal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="testimonial-form">
                <input type="hidden" id="testimonial-id">
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Client Name *</label>
                    <input type="text" id="testimonial-name" required class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Client Title/Position</label>
                    <input type="text" id="testimonial-title" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                </div>
                
                <div class="mb-4">
                    <label class="block font-semibold mb-2">Testimonial Message *</label>
                    <textarea id="testimonial-message" required rows="4" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none"></textarea>
                </div>
                
                <div class="mb-6">
                    <label class="block font-semibold mb-2">Rating</label>
                    <select id="testimonial-rating" class="w-full border-2 border-gray-300 px-4 py-2 rounded focus:border-orange-500 outline-none">
                        <option value="5">5 Stars</option>
                        <option value="4">4 Stars</option>
                        <option value="3">3 Stars</option>
                        <option value="2">2 Stars</option>
                        <option value="1">1 Star</option>
                    </select>
                </div>
                
                <div class="flex gap-4">
                    <button type="submit" class="bg-orange-500 text-white px-6 py-3 rounded font-semibold hover:bg-orange-600 transition flex-1">
                        Save Testimonial
                    </button>
                    <button type="button" onclick="closeModal('testimonial-modal')" class="bg-gray-300 text-gray-700 px-6 py-3 rounded font-semibold hover:bg-gray-400 transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Check authentication
        async function checkAuth() {
            const response = await fetch('auth.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'check'})
            });
            const data = await response.json();
            
            if (!data.logged_in) {
                window.location.href = 'admin-login.html';
            } else {
                document.getElementById('admin-username').textContent = data.user.username;
            }
        }

        // Logout
        async function logout() {
            const response = await fetch('auth.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'logout'})
            });
            window.location.href = 'admin-login.html';
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tabName === 'projects') loadProjects();
            if (tabName === 'services') loadServices();
            if (tabName === 'testimonials') loadTestimonials();
            if (tabName === 'messages') loadMessages();
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Reset forms
            if (modalId === 'project-modal') document.getElementById('project-form').reset();
            if (modalId === 'service-modal') document.getElementById('service-form').reset();
            if (modalId === 'testimonial-modal') document.getElementById('testimonial-form').reset();
        }

        // PROJECTS CRUD
        async function loadProjects() {
            const response = await fetch('api.php?action=projects');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.getElementById('projects-table');
                tbody.innerHTML = '';
                
                data.data.forEach(project => {
                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-6 py-4">${project.title}</td>
                            <td class="px-6 py-4">${project.category || 'N/A'}</td>
                            <td class="px-6 py-4">${new Date(project.created_at).toLocaleDateString()}</td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="editProject(${project.id})" class="text-blue-600 hover:underline mr-3">Edit</button>
                                <button onclick="deleteProject(${project.id})" class="text-red-600 hover:underline">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        document.getElementById('project-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('project-id').value;
            const projectData = {
                title: document.getElementById('project-title').value,
                category: document.getElementById('project-category').value,
                description: document.getElementById('project-description').value,
                tags: document.getElementById('project-tags').value,
                image_url: document.getElementById('project-image').value
            };
            
            const url = id ? `api.php?action=projects&id=${id}` : 'api.php?action=projects';
            const method = id ? 'PUT' : 'POST';
            
            const response = await fetch(url, {
                method: method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(projectData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(data.message);
                closeModal('project-modal');
                loadProjects();
            }
        });

        async function editProject(id) {
            const response = await fetch(`api.php?action=projects&id=${id}`);
            const data = await response.json();
            
            if (data.success) {
                const project = data.data;
                document.getElementById('project-id').value = project.id;
                document.getElementById('project-title').value = project.title;
                document.getElementById('project-category').value = project.category;
                document.getElementById('project-description').value = project.description;
                document.getElementById('project-tags').value = project.tags;
                document.getElementById('project-image').value = project.image_url;
                openModal('project-modal');
            }
        }

        async function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                const response = await fetch(`api.php?action=projects&id=${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    loadProjects();
                }
            }
        }

        // SERVICES CRUD
        async function loadServices() {
            const response = await fetch('api.php?action=services');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.getElementById('services-table');
                tbody.innerHTML = '';
                
                data.data.forEach(service => {
                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-6 py-4">${service.title}</td>
                            <td class="px-6 py-4 text-2xl">${service.icon}</td>
                            <td class="px-6 py-4">${service.description.substring(0, 50)}...</td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="editService(${service.id})" class="text-blue-600 hover:underline mr-3">Edit</button>
                                <button onclick="deleteService(${service.id})" class="text-red-600 hover:underline">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        document.getElementById('service-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('service-id').value;
            const serviceData = {
                title: document.getElementById('service-title').value,
                icon: document.getElementById('service-icon').value,
                description: document.getElementById('service-description').value
            };
            
            const url = id ? `api.php?action=services&id=${id}` : 'api.php?action=services';
            const method = id ? 'PUT' : 'POST';
            
            const response = await fetch(url, {
                method: method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(serviceData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(data.message);
                closeModal('service-modal');
                loadServices();
            }
        });

        async function editService(id) {
            const response = await fetch(`api.php?action=services`);
            const data = await response.json();
            
            if (data.success) {
                const service = data.data.find(s => s.id === id);
                document.getElementById('service-id').value = service.id;
                document.getElementById('service-title').value = service.title;
                document.getElementById('service-icon').value = service.icon;
                document.getElementById('service-description').value = service.description;
                openModal('service-modal');
            }
        }

        async function deleteService(id) {
            if (confirm('Are you sure you want to delete this service?')) {
                const response = await fetch(`api.php?action=services&id=${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    loadServices();
                }
            }
        }

        // TESTIMONIALS CRUD
        async function loadTestimonials() {
            const response = await fetch('api.php?action=testimonials');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.getElementById('testimonials-table');
                tbody.innerHTML = '';
                
                data.data.forEach(testimonial => {
                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-6 py-4">${testimonial.client_name}</td>
                            <td class="px-6 py-4">${testimonial.client_title || 'N/A'}</td>
                            <td class="px-6 py-4">${'⭐'.repeat(testimonial.rating)}</td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="editTestimonial(${testimonial.id})" class="text-blue-600 hover:underline mr-3">Edit</button>
                                <button onclick="deleteTestimonial(${testimonial.id})" class="text-red-600 hover:underline">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        document.getElementById('testimonial-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('testimonial-id').value;
            const testimonialData = {
                client_name: document.getElementById('testimonial-name').value,
                client_title: document.getElementById('testimonial-title').value,
                message: document.getElementById('testimonial-message').value,
                rating: parseInt(document.getElementById('testimonial-rating').value)
            };
            
            const url = id ? `api.php?action=testimonials&id=${id}` : 'api.php?action=testimonials';
            const method = id ? 'PUT' : 'POST';
            
            const response = await fetch(url, {
                method: method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(testimonialData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(data.message);
                closeModal('testimonial-modal');
                loadTestimonials();
            }
        });

        async function editTestimonial(id) {
            const response = await fetch(`api.php?action=testimonials`);
            const data = await response.json();
            
            if (data.success) {
                const testimonial = data.data.find(t => t.id === id);
                document.getElementById('testimonial-id').value = testimonial.id;
                document.getElementById('testimonial-name').value = testimonial.client_name;
                document.getElementById('testimonial-title').value = testimonial.client_title;
                document.getElementById('testimonial-message').value = testimonial.message;
                document.getElementById('testimonial-rating').value = testimonial.rating;
                openModal('testimonial-modal');
            }
        }

        async function deleteTestimonial(id) {
            if (confirm('Are you sure you want to delete this testimonial?')) {
                const response = await fetch(`api.php?action=testimonials&id=${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    loadTestimonials();
                }
            }
        }

        // MESSAGES
        async function loadMessages() {
            const response = await fetch('api.php?action=messages');
            const data = await response.json();
            
            if (data.success) {
                const container = document.getElementById('messages-container');
                const newCount = data.data.filter(m => m.status === 'new').length;
                document.getElementById('message-count').textContent = newCount;
                
                container.innerHTML = '';
                
                data.data.forEach(message => {
                    const statusColor = message.status === 'new' ? 'bg-blue-100 border-blue-500' : 'bg-gray-100 border-gray-300';
                    
                    container.innerHTML += `
                        <div class="bg-white p-6 rounded-lg shadow border-l-4 ${statusColor}">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="font-bold text-lg">${message.name}</h3>
                                    <p class="text-sm text-gray-600">${message.email} • ${message.service}</p>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block px-3 py-1 rounded text-sm font-semibold ${message.status === 'new' ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-700'}">
                                        ${message.status}
                                    </span>
                                    <p class="text-xs text-gray-500 mt-1">${new Date(message.created_at).toLocaleString()}</p>
                                </div>
                            </div>
                            <p class="text-gray-700 mb-4">${message.message}</p>
                            <div class="flex gap-2">
                                <button onclick="updateMessageStatus(${message.id}, 'read')" class="text-sm bg-gray-200 px-4 py-2 rounded hover:bg-gray-300 transition">
                                    Mark as Read
                                </button>
                                <button onclick="updateMessageStatus(${message.id}, 'responded')" class="text-sm bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                                    Mark as Responded
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
        }

        async function updateMessageStatus(id, status) {
            const response = await fetch(`api.php?action=messages&id=${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({status: status})
            });
            
            const data = await response.json();
            
            if (data.success) {
                loadMessages();
            }
        }

        // Initialize
        checkAuth();
        loadProjects();
    </script>
</body>
</html>
